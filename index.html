<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
    <script>
        var _LTracker = _LTracker || [];
        _LTracker.push({
            'logglyKey': 'your-customer-token',
            'sendConsoleErrors': true,
            'tag': 'javascript-logs'
        });
    </script>
    <style type="text/css">
        #mapid {
            position: absolute;
            top:0;
            left: 0;
            height: -webkit-calc(100% - 50px);
            height: -moz-calc(100% - 50px);
            height: calc(100% - 50px);
            width: 100%;
        }
        #controls {
            position: absolute;
            top: -webkit-calc(100% - 40px);
            top: -moz-calc(100% - 40px);
            top: calc(100% - 40px);
        }
        .speedIcon {
            background-color: transparent;
            border: none;
            font-size: 150%;
            color: purple;
        }

    </style>
</head>
<body>
<div id="mapid"></div>

<div id="controls">
    <button onclick="mymap.fitBounds(trackLine.getBounds())">Fit to track</button>

    <select onchange="for (var i = 0; i < tilelayers.length; i++) {
  if(this.value!=i)tilelayers[i].remove(); else tilelayers[i].addTo(mymap);

}">
        <option value="0">MapBox</option>
        <option value="1">NatGeo_World_Map</option>
        <option value="2">World_Imagery</option>
    </select>
</div>
<script>
    var userPassword = "ilya:Aaabbb11";

    var trackLine = null;
    var markers = [];

    var mymap = L.map('mapid').setView([60.20, 22.2], 12);

    var tilelayers = [
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoiZWxtb3Q3MyIsImEiOiJjaXR1a2FwNmwwMDBoM25vYWwwcXRvemkyIn0.HKq9jC6GWS8cYTatXh82Gg'
        }),
        L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC',
            maxZoom: 16
        }),
        L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        })];
    tilelayers[0].addTo(mymap);
</script>
<script>
    function parseTrack(responseText) {
        var track = JSON.parse(xhr.responseText);
        var coords = [];
        var newMarkers = [];

        for (var i = 0; i < track.events.length; i++) {
            var location = track.events[i].event.json.location;
            if (location != null && location.fix != "n") {

                var lat = location.lat;
                var lon = location.lon;
                if (lat != null && lon != null) {
                    coords.push([lat, lon]);
                    if (coords.length % 10 == 0) {
                        var sog = Math.round(location.sog / 0.1852) / 10;
                        var marker = L.marker([lat, lon], {icon: L.divIcon({html: sog, className: "speedIcon"})});
                        newMarkers.push(marker);
                    }
                }
            }
        }
        if (trackLine != null) {
            trackLine.remove();
            trackLine = null;
            for (var i = 0; i < markers.length; i++) {
                markers[i].remove();
            }
        }
        if (coords.length > 0) {
            trackLine = L.polyline(coords, {color: 'orange'}).addTo(mymap);
            markers = newMarkers;
            for (var i = 0; i < markers.length; i++) {
                markers[i].addTo(mymap);

            }
        }
    }

    var xhr = new XMLHttpRequest();
    function renewMap() {
        {
            xhr.open('GET', 'https://ilya.loggly.com/apiv2/search?q=*&from=-1d&until=now&size=1000', true);
            xhr.setRequestHeader("Authorization", "Basic " + btoa(userPassword));
            xhr.onreadystatechange = function (e) {
                if (xhr.readyState == 4) {
                    var stage1 = JSON.parse(xhr.responseText);
                    xhr.open('GET', 'https://ilya.loggly.com/apiv2/events?rsid=' + stage1.rsid.id, true);
                    xhr.setRequestHeader("Authorization", "Basic " + btoa(userPassword));
                    xhr.onreadystatechange = function (e) {
                        if (xhr.readyState == 4) {
                            parseTrack(xhr.responseText);
                            window.setTimeout(renewMap, 60000);
                        }
                    };
                    xhr.send();
                }
            };
            xhr.send();
        }
    }
    renewMap();

</script>
</body>
</html>